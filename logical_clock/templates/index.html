<!DOCTYPE html>
<html>
<head>
    <title>Logical Clocks</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .node {
            fill: lightblue;
            stroke: black;
            stroke-width: 2px;
        }
        .link {
            fill: none;
            stroke: black;
            stroke-width: 2px;
        }
        .timestamp {
            fill: red;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Logical Clocks</h1>
    <p id="node-0">Node 0: 0</p>
    <p id="node-1">Node 1: 0</p>
    <p id="node-2">Node 2: 0</p>
    <svg width="1000" height="400"></svg>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', (event) => {
            var socket = io.connect('http://' + document.domain + ':' + location.port);
            var svg = d3.select("svg");
            var nodes = [
                {id: 0, x: 500, y: 300},
                {id: 1, x: 700, y: 100},
                {id: 2, x: 900, y: 300}
            ];

            svg.selectAll(".node")
                .data(nodes)
                .enter()
                .append("circle")
                .attr("class", "node")
                .attr("r", 20)
                .attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });

            var updateClock = function(data) {
                document.getElementById('node-' + data.node).innerText = 'Node ' + data.node + ': ' + data.clock;
                svg.append("text")
                    .attr("class", "timestamp")
                    .attr("x", nodes[data.node].x)
                    .attr("y", nodes[data.node].y - 30)
                    .text(new Date(data.timestamp * 1000).toLocaleTimeString())
                    .transition()
                    .duration(2000)
                    .style("opacity", 0)
                    .remove();
            };

            var drawMessage = function(data) {
                var sender = nodes[data.sender];
                var recipient = nodes[data.recipient];
                svg.append("line")
                    .attr("class", "link")
                    .attr("x1", sender.x)
                    .attr("y1", sender.y)
                    .attr("x2", sender.x)
                    .attr("y2", sender.y)
                    .transition()
                    .duration(1000)
                    .attr("x2", recipient.x)
                    .attr("y2", recipient.y)
                    .remove();

                svg.append("text")
                    .attr("class", "timestamp")
                    .attr("x", (sender.x + recipient.x) / 2)
                    .attr("y", (sender.y + recipient.y) / 2 - 10)
                    .text(new Date(data.timestamp * 1000).toLocaleTimeString())
                    .transition()
                    .duration(2000)
                    .style("opacity", 0)
                    .remove();
            };

            socket.on('clock_update', updateClock);
            socket.on('message_send', drawMessage);
        });
    </script>
</body>
</html>
